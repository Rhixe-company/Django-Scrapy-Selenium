"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3173],{65076:function(e,t,s){s.r(t),s.d(t,{default:function(){return ep}});var a,i,n=s(68247),l=s(80888),r=s(8201),c=s(61524),o=s(59355),d=s(58023),u=s(57038),m=s(94325);let x=function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:3e3;(0,m.A)({title:e,description:(0,n.jsx)("div",{children:(0,n.jsx)("span",{className:s,children:t})}),duration:a})},h=()=>{x("500: An error occurred","Got an unexpected response from the server, please try again in a few minutes","font-bold text-red-400",1e4)},p=()=>{x("429: Rate Limited","Please slow down. You may try again in a few minutes","font-bold text-red-400",3e3)},v=e=>"key"in e,f=(e,t,s)=>{let{mouseOnly:a}=s;(0,l.useEffect)(()=>{let s=s=>{let i=e.current;if(i){if(a&&s instanceof MouseEvent){if(i.contains(s.target))return;t(s)}else if(a||v(s))v(s)&&"Escape"===s.key&&t(s);else{if(i.contains(s.target))return;t(s)}}};return a?document.addEventListener("mousedown",s):(document.addEventListener("mousedown",s),document.addEventListener("touchstart",s),document.addEventListener("keydown",s)),()=>{a?document.removeEventListener("mousedown",s):(document.removeEventListener("mousedown",s),document.removeEventListener("touchstart",s),document.removeEventListener("keydown",s))}},[e,t,a])};var j=s(57302),D=s(75861),b=s(43254),g=s(50449),N=s(5602),y=s(51117),w=s(614),E=s(77565),z=s(10994);let k=z.fC,C=z.xz,S=l.forwardRef((e,t)=>{let{className:s,align:a="center",sideOffset:i=4,...l}=e;return(0,n.jsx)(z.h_,{children:(0,n.jsx)(z.VY,{ref:t,align:a,sideOffset:i,className:(0,d.cn)("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...l})})});S.displayName=z.VY.displayName;var Z=s(81890);let _=l.forwardRef((e,t)=>{let{className:s,children:a,...i}=e;return(0,n.jsxs)(Z.fC,{ref:t,className:(0,d.cn)("relative overflow-hidden",s),...i,children:[(0,n.jsx)(Z.l_,{className:"h-full w-full rounded-[inherit]",children:a}),(0,n.jsx)(T,{}),(0,n.jsx)(Z.Ns,{})]})});_.displayName=Z.fC.displayName;let T=l.forwardRef((e,t)=>{let{className:s,orientation:a="vertical",...i}=e;return(0,n.jsx)(Z.gb,{ref:t,orientation:a,className:(0,d.cn)("flex touch-none select-none transition-colors","vertical"===a&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===a&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",s),...i,children:(0,n.jsx)(Z.q4,{className:"relative flex-1 rounded-full bg-border"})})});T.displayName=Z.gb.displayName;let L=["\uD83D\uDE00","\uD83D\uDE03","\uD83D\uDE04","\uD83D\uDE01","\uD83D\uDE06","\uD83D\uDE05","\uD83D\uDE02","\uD83E\uDD23","\uD83D\uDE0A","\uD83D\uDE07","\uD83D\uDE42","\uD83D\uDE43","\uD83D\uDE09","\uD83D\uDE0C","\uD83D\uDE0D","\uD83E\uDD70","\uD83D\uDE18","\uD83D\uDE17","\uD83D\uDE19","\uD83D\uDE1A","\uD83D\uDE0B","\uD83D\uDE1B","\uD83D\uDE1D","\uD83D\uDE1C","\uD83E\uDD2A","\uD83E\uDD28","\uD83E\uDDD0","\uD83E\uDD13","\uD83D\uDE0E","\uD83E\uDD29","\uD83E\uDD73","\uD83D\uDE0F","\uD83D\uDE12","\uD83D\uDE1E","\uD83D\uDE14","\uD83D\uDE1F","\uD83D\uDE15","\uD83D\uDE41","☹️","\uD83D\uDE23","\uD83D\uDE16","\uD83D\uDE2B","\uD83D\uDE29","\uD83E\uDD7A","\uD83D\uDE22","\uD83D\uDE2D","\uD83D\uDE24","\uD83D\uDE20","\uD83D\uDE21","\uD83E\uDD2C","\uD83E\uDD2F","\uD83D\uDE33","\uD83E\uDD75","\uD83E\uDD76","\uD83D\uDE31","\uD83D\uDE28","\uD83D\uDE30","\uD83D\uDE25","\uD83D\uDE13","\uD83E\uDD17","\uD83E\uDD14","\uD83E\uDD2D","\uD83E\uDD2B","\uD83E\uDD25","\uD83D\uDE36","\uD83D\uDE10","\uD83D\uDE11","\uD83D\uDE2C","\uD83D\uDE44","\uD83D\uDE2F","\uD83D\uDE26","\uD83D\uDE27","\uD83D\uDE2E","\uD83D\uDE32","\uD83E\uDD71","\uD83D\uDE34","\uD83E\uDD24","\uD83D\uDE2A","\uD83D\uDE35","\uD83E\uDD10","\uD83E\uDD74","\uD83E\uDD22","\uD83E\uDD2E","\uD83E\uDD27","\uD83D\uDE37","\uD83E\uDD12","\uD83E\uDD15","\uD83E\uDD11","\uD83E\uDD20","\uD83D\uDE08"];function R(e){let{onChange:t,content:s="",editable:a=!0,placeholder:i="Join the discussion...",onSubmit:r}=e,[c,o]=(0,l.useState)(null),[u,m]=(0,l.useState)(""),[x,h]=(0,l.useState)(!1),[p,v]=(0,l.useState)(!1),[f,z]=(0,l.useState)(!1),[Z,T]=(0,l.useState)(0),[R,A]=(0,l.useState)(!1),[F,V]=(0,l.useState)(!1);(0,l.useRef)(null),(0,l.useRef)(null);let Y=(0,j.jE)({extensions:[D.Z,b.Z.configure({placeholder:i,emptyEditorClass:"is-editor-empty"})],content:s,editable:a,onUpdate:e=>{let{editor:s}=e,a=s.getHTML();null==t||t(a);let i=s.getText().length;T(i),A(i>1e3),V(i>=800&&i<=1e3)},editorProps:{attributes:{class:"prose prose-invert prose-sm sm:prose-base focus:outline-none max-w-none min-h-[120px]"}}});return((0,l.useEffect)(()=>{if(Y&&s&&s!==Y.getHTML()){Y.commands.setContent(s);let e=Y.getText().length;T(e),A(e>1e3),V(e>=800&&e<=1e3)}},[s,Y]),Y)?(0,n.jsxs)("div",{className:"w-full",onKeyDown:e=>{"Enter"===e.key&&(e.metaKey||e.ctrlKey)&&!R&&(e.preventDefault(),null==r||r())},children:[(0,n.jsxs)("div",{className:"relative min-h-[120px] rounded-md",children:[(0,n.jsx)(j.kg,{editor:Y,className:"min-h-[120px] text-sm text-zinc-200 focus-visible:ring-0 p-0",style:{overflow:"hidden",overflowWrap:"anywhere",wordBreak:"normal",hyphens:"none"}}),Y&&(0,n.jsx)(j.NM,{editor:Y,tippyOptions:{duration:100},className:"bg-zinc-800 rounded-md shadow-lg border border-zinc-700 overflow-hidden",children:(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)("button",{onClick:()=>Y.chain().focus().toggleBold().run(),className:(0,d.cn)("p-2 hover:bg-zinc-700/50 text-zinc-400 hover:text-[#9333ea]",Y.isActive("bold")&&"text-[#9333ea] bg-zinc-700/30"),children:(0,n.jsx)(g.Z,{className:"w-4 h-4"})}),(0,n.jsx)("button",{onClick:()=>Y.chain().focus().toggleItalic().run(),className:(0,d.cn)("p-2 hover:bg-zinc-700/50 text-zinc-400 hover:text-[#9333ea]",Y.isActive("italic")&&"text-[#9333ea] bg-zinc-700/30"),children:(0,n.jsx)(N.Z,{className:"w-4 h-4"})}),(0,n.jsx)("button",{onClick:()=>Y.chain().focus().toggleStrike().run(),className:(0,d.cn)("p-2 hover:bg-zinc-700/50 text-zinc-400 hover:text-[#9333ea]",Y.isActive("strike")&&"text-[#9333ea] bg-zinc-700/30"),children:(0,n.jsx)(y.Z,{className:"w-4 h-4"})})]})})]}),(0,n.jsxs)("div",{className:"flex items-center justify-between mt-2 border-t border-zinc-800 pt-2",children:[(0,n.jsxs)("div",{className:"flex items-center gap-0.5",children:[(0,n.jsxs)(k,{children:[(0,n.jsx)(C,{asChild:!0,children:(0,n.jsx)("button",{className:"p-1.5 rounded hover:bg-zinc-700/50 text-yellow-400 hover:text-yellow-300 transition-colors",title:"Insert Emoji",children:(0,n.jsx)(w.Z,{className:"w-4 h-4"})})}),(0,n.jsx)(S,{className:"w-[320px] p-0 bg-zinc-800 border-zinc-700",children:(0,n.jsx)(_,{className:"h-[250px] p-4",children:(0,n.jsx)("div",{className:"grid grid-cols-8 gap-1.5",children:L.map(e=>(0,n.jsx)("button",{onClick:()=>{Y.chain().focus().insertContent(e).run()},className:"text-2xl hover:bg-zinc-700 rounded aspect-square flex items-center justify-center transition-colors",children:e},e))})})})]}),(0,n.jsx)("button",{onClick:()=>Y.chain().focus().toggleBold().run(),className:(0,d.cn)("p-1.5 rounded hover:bg-zinc-700/50 text-zinc-400 hover:text-[#9333ea] transition-colors",Y.isActive("bold")&&"text-[#9333ea] bg-zinc-700/30"),title:"Bold",children:(0,n.jsx)(g.Z,{className:"w-4 h-4"})}),(0,n.jsx)("button",{onClick:()=>Y.chain().focus().toggleItalic().run(),className:(0,d.cn)("p-1.5 rounded hover:bg-zinc-700/50 text-zinc-400 hover:text-[#9333ea] transition-colors",Y.isActive("italic")&&"text-[#9333ea] bg-zinc-700/30"),title:"Italic",children:(0,n.jsx)(N.Z,{className:"w-4 h-4"})}),(0,n.jsx)("button",{onClick:()=>Y.chain().focus().toggleStrike().run(),className:(0,d.cn)("p-1.5 rounded hover:bg-zinc-700/50 text-zinc-400 hover:text-[#9333ea] transition-colors",Y.isActive("strike")&&"text-[#9333ea] bg-zinc-700/30"),title:"Strikethrough",children:(0,n.jsx)(y.Z,{className:"w-4 h-4"})})]}),(0,n.jsx)("div",{className:"flex items-center text-xs",children:(0,n.jsxs)("div",{className:(0,d.cn)("transition-colors",R?"text-red-400":F?"text-amber-400":"text-zinc-400"),children:[Z,"/",1e3," characters"]})})]}),R&&(0,n.jsxs)("div",{className:"mt-2 flex items-center gap-2 text-xs text-red-400 bg-red-950/20 border border-red-900/30 rounded-md px-3 py-2",children:[(0,n.jsx)(E.Z,{className:"w-4 h-4 flex-shrink-0"}),(0,n.jsxs)("span",{children:["Your comment exceeds the ",1e3," character limit. Please shorten it to post."]})]})]}):null}var A=s(68390),F=s(26203),V=s(83076),Y=s(69226),I=s(16723),O=s(14950),P=s(47755),B=s(94831);function M(e){let{isOpen:t,onClose:s,email:a,onVerify:i}=e,[r,o]=(0,l.useState)(!1),[u,x]=(0,l.useState)(!1),{user:h,mutate:v}=(0,B.a)(),[f,j]=(0,l.useState)(!1),[D,b]=(0,l.useState)(!1),[g,N]=(0,l.useState)(!1),[y,w]=(0,l.useState)("setup"),[z,k]=(0,l.useState)(!1),[C,S]=(0,l.useState)(0),Z=(0,l.useRef)(null);(0,l.useEffect)(()=>()=>{Z.current&&clearInterval(Z.current)},[]);let _=e=>{k(!0),S(e),(0,m.A)({title:"Rate limit reached",description:"You can only react 5 times per minute. Please try again in ".concat(e," seconds.")}),Z.current=setInterval(()=>{S(e=>(e<=1&&(k(!1),Z.current&&clearInterval(Z.current)),e-1))},1e3)},T=async()=>{var e,t,n,l;j(!0);let r=await (0,c.LN)("/api/v1/send-verification-email");if(r.ok)j(!1),N(!0),(0,m.A)({title:"Verification email sent",description:"We've sent a new verification email to ".concat(a)}),w("initial");else if(r.ratelimited)_(null==r?void 0:null===(e=r.body)||void 0===e?void 0:e.seconds_until_reset),p(),j(!1),N(!1);else{if((null===(t=r.body)||void 0===t?void 0:t.message)==="Email has already been verified."&&(w("success"),await v(),setTimeout(()=>{s(),i&&i()},3e3)),(null===(n=r.body)||void 0===n?void 0:n.message)==="Please reach out to support if you need to resend an email verification link. You have reached the maximum number of attempts."){x(!0);return}(0,m.A)({title:"Something went wrong",description:(null===(l=r.body)||void 0===l?void 0:l.message)||"Please retry in a minute"}),j(!1),N(!1)}},L=async()=>{var e,t,n;o(!0);let l=await (0,c.LN)("/api/v1/resend-verification-email");l.ok?(o(!1),b(!0),(0,m.A)({title:"Verification email sent",description:"We've sent a new verification email to ".concat(a)}),w("initial")):l.ratelimited?(_(null==l?void 0:null===(e=l.body)||void 0===e?void 0:e.seconds_until_reset),p(),o(!1),b(!1)):((null===(t=l.body)||void 0===t?void 0:t.message)==="Email has already been verified."&&(w("success"),await v(),setTimeout(()=>{s(),i&&i()},3e3)),(null===(n=l.body)||void 0===n?void 0:n.message)==="Please reach out to support if you need to resend an email verification link. You have reached the maximum number of attempts."&&x(!0),(0,m.A)({title:"Something went wrong",description:"Please retry in a minute"}),j(!1),N(!1)),setTimeout(()=>{b(!1)},3e3)},R=async()=>{w("checking"),(await (0,c.LN)("/api/v1/check-email-verification")).ok?(w("success"),await v(),setTimeout(()=>{s(),i&&i()},3e3)):setTimeout(()=>{w("failed-initial"),(0,m.A)({title:"Verification failed",description:"Please try again later."})},2e3)},F=()=>(0,n.jsxs)("p",{className:"text-xs text-zinc-500 text-center",children:["Need help?"," ",(0,n.jsx)("a",{href:"https://asura.youtrack.cloud/form/9af450f6-c900-42ea-a88f-8169f8578223",className:"text-purple-400 hover:text-purple-300",children:"Contact Support"})]});return(0,n.jsx)(I.Vq,{open:t,onOpenChange:s,children:(0,n.jsxs)(I.cZ,{className:"bg-zinc-900 border-zinc-800 text-white max-w-md",children:[(0,n.jsxs)(I.fK,{children:[(0,n.jsxs)(I.$N,{className:"text-xl font-bold flex items-center gap-2",children:[(0,n.jsx)(V.Z,{className:"w-5 h-5 text-purple-400"}),"Verify Your Email"]}),(0,n.jsx)(I.Be,{className:"text-zinc-400",children:"Please verify your email address before posting comments."})]}),u?(0,n.jsxs)("div",{className:"space-y-4 py-2",children:[(0,n.jsx)("div",{className:"flex flex-col gap-3",children:(0,n.jsx)("div",{className:"bg-zinc-800/50 p-4 rounded-lg border border-zinc-700/50",children:(0,n.jsxs)("div",{className:"flex items-start gap-3",children:[(0,n.jsx)(E.Z,{className:"w-5 h-5 text-amber-400 flex-shrink-0 mt-0.5"}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)("p",{className:"text-sm text-zinc-300",children:"Please reach out to support if you need to resend an email verification link. You have reached the maximum number of attempts."}),(0,n.jsx)("p",{className:"text-xs text-zinc-400",children:"Please check your inbox and click the verification link to activate your account. If you don't see the email, check your spam folder."})]})]})})}),F()]}):(0,n.jsxs)(n.Fragment,{children:["setup"===y&&(0,n.jsxs)("div",{className:"space-y-4 py-2",children:[(0,n.jsxs)("div",{className:"flex flex-col gap-3",children:[z&&(0,n.jsx)("div",{className:"bg-zinc-800/50 p-4 rounded-lg border border-zinc-700/50",children:(0,n.jsxs)("div",{className:"flex items-start gap-3",children:[(0,n.jsx)(E.Z,{className:"w-5 h-5 text-amber-400 flex-shrink-0 mt-0.5"}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsxs)("p",{className:"text-sm text-zinc-300",children:["We've already sent a verification email to ",(0,n.jsx)("span",{className:"font-medium text-white",children:a})]}),(0,n.jsx)("p",{className:"text-xs text-zinc-400",children:"Please check your inbox and click the verification link to activate your account. If you don't see the email, check your spam folder."})]})]})}),(0,n.jsx)(A.z,{variant:"outline",onClick:T,disabled:f||g||z,className:(0,d.cn)("border-zinc-700 text-zinc-300 hover:bg-zinc-800 hover:text-white",(f||g)&&"opacity-70"),children:f?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(O.Z,{className:"w-4 h-4 mr-2 animate-spin"}),"Sending..."]}):g?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(P.Z,{className:"w-4 h-4 mr-2 text-green-500"}),"Email Sent"]}):z?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(E.Z,{className:"w-4 h-4 mr-2 text-red-500"}),"You can resend in ",C," seconds."]}):"Send Verification Email"})]}),F()]}),"initial"===y&&(0,n.jsxs)("div",{className:"space-y-4 py-2",children:[(0,n.jsx)("div",{className:"bg-zinc-800/50 p-4 rounded-lg border border-zinc-700/50",children:(0,n.jsxs)("div",{className:"flex items-start gap-3",children:[(0,n.jsx)(E.Z,{className:"w-5 h-5 text-amber-400 flex-shrink-0 mt-0.5"}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsxs)("p",{className:"text-sm text-zinc-300",children:["We've sent a verification email to ",(0,n.jsx)("span",{className:"font-medium text-white",children:a})]}),(0,n.jsx)("p",{className:"text-xs text-zinc-400",children:"Please check your inbox and click the verification link to activate your account. If you don't see the email, check your spam folder."})]})]})}),(0,n.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,n.jsx)(A.z,{onClick:R,className:"bg-[#9333ea] hover:bg-[#7928ca] text-white",children:"I've Verified My Email"}),(0,n.jsx)(A.z,{variant:"outline",onClick:L,disabled:r||D||z,className:(0,d.cn)("border-zinc-700 text-zinc-300 hover:bg-zinc-800 hover:text-white",(r||D)&&"opacity-70"),children:r?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(O.Z,{className:"w-4 h-4 mr-2 animate-spin"}),"Sending..."]}):D?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(P.Z,{className:"w-4 h-4 mr-2 text-green-500"}),"Email Sent"]}):z?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(E.Z,{className:"w-4 h-4 mr-2 text-red-500"}),"You can resend in ",C," seconds."]}):"Resend Verification Email"})]}),F()]}),"failed-initial"===y&&(0,n.jsxs)("div",{className:"space-y-4 py-2",children:[(0,n.jsx)("div",{className:"bg-zinc-800/50 p-4 rounded-lg border border-zinc-700/50",children:(0,n.jsxs)("div",{className:"flex items-start gap-3",children:[(0,n.jsx)(E.Z,{className:"w-5 h-5 text-amber-400 flex-shrink-0 mt-0.5"}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)("p",{className:"text-sm text-zinc-300",children:"Failed to verify"}),(0,n.jsx)("p",{className:"text-xs text-zinc-400",children:"Please check your inbox and click the verification link to activate your account. If you don't see the email, check your spam folder."})]})]})}),(0,n.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,n.jsx)(A.z,{onClick:R,className:"bg-[#9333ea] hover:bg-[#7928ca] text-white",children:"I've Verified My Email"}),(0,n.jsx)(A.z,{variant:"outline",onClick:L,disabled:r||D||z,className:(0,d.cn)("border-zinc-700 text-zinc-300 hover:bg-zinc-800 hover:text-white",(r||D)&&"opacity-70"),children:r?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(O.Z,{className:"w-4 h-4 mr-2 animate-spin"}),"Sending..."]}):D?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(P.Z,{className:"w-4 h-4 mr-2 text-green-500"}),"Email Sent"]}):z?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(E.Z,{className:"w-4 h-4 mr-2 text-red-500"}),"You can resend in ",C," seconds."]}):"Resend Verification Email"})]}),F()]}),"checking"===y&&(0,n.jsxs)("div",{className:"py-6 flex flex-col items-center justify-center",children:[(0,n.jsx)(O.Z,{className:"w-10 h-10 text-purple-500 animate-spin mb-4"}),(0,n.jsx)("p",{className:"text-zinc-300",children:"Checking verification status..."})]}),"success"===y&&(0,n.jsxs)("div",{className:"py-6 flex flex-col items-center justify-center",children:[(0,n.jsx)("div",{className:"w-16 h-16 rounded-full bg-green-900/30 flex items-center justify-center mb-4",children:(0,n.jsx)(P.Z,{className:"w-10 h-10 text-green-500"})}),(0,n.jsx)("p",{className:"text-xl font-medium text-white mb-1",children:"Email Verified!"}),(0,n.jsx)("p",{className:"text-zinc-400 text-center",children:"You can now post comments and interact with the community."})]})]})]})})}function H(e){let{classname:t,metadata:s,is_reply:a,parent_id:i,handleMutate:m,onSubmitCallback:v}=e,j=(0,Y.useRouter)(),{mutate:D}=(0,u.kY)(),{user:b,isLoggedIn:g}=(0,o.a)(),[N,y]=(0,l.useState)(""),[w,E]=(0,l.useState)(!1),[z,k]=(0,l.useState)(0),[C,S]=(0,l.useState)(!1),Z=(0,l.useRef)(null),[_,T]=(0,l.useState)(!1);f(Z,()=>{a||O()},{mouseOnly:!0});let L=s.is_series?"/api/v1/comments/series/".concat(s.id):"/api/v1/comments/chapter/".concat(s.id);(0,l.useEffect)(()=>{a&&E(!0)},[a]);let I=async()=>{try{let e;g||j.push("/login"),e=a&&0!=i?{body:N,is_reply:!0,parent_id:i}:{body:N};let t=await (0,c.LN)(L,e);if(t.ok){x("Comment posted","Your comment has been posted, it may take a couple of seconds for it to show up"),null==v||v(),setTimeout(async()=>{await D(L)},1e3);return}if(t.bad){if(t.badinput){x("400: Bad Input",t.body.message,"font-bold text-red-400",5e3);return}if(t.forbidden){x("Forbidden",t.body.message,"font-bold text-red-400",5e3);return}if(t.ratelimited){p();return}}}catch(e){console.log(e),h()}},O=()=>{N||E(!1)};return(0,n.jsxs)("div",{ref:Z,className:(0,d.cn)("bg-zinc-900/50 rounded-lg border border-zinc-800/50 transition-all duration-200",w?"shadow-md":"",a&&"bg-zinc-900/70",t),children:[!g&&(0,n.jsxs)("div",{className:"bg-zinc-900/50 rounded-lg border border-zinc-800 flex items-center justify-between px-4 py-2 border-b border-zinc-800/50",children:[(0,n.jsx)("span",{className:"text-sm text-zinc-400",children:"Log in to join the conversation"}),(0,n.jsx)("a",{href:"/login",children:(0,n.jsxs)(A.z,{variant:"ghost",size:"sm",className:"text-[#9333ea] hover:text-[#7928ca] hover:bg-[#9333ea]/10",children:[(0,n.jsx)(F.Z,{className:"w-4 h-4 mr-1.5"}),"Log in"]})})]}),g&&(null==b?void 0:b.flags.email_verified)===!1&&(0,n.jsxs)("div",{className:"flex items-center justify-between px-4 py-2 border-b border-zinc-800/50 bg-amber-900/20",children:[(0,n.jsx)("span",{className:"text-sm text-amber-200",children:"Verify your email to join the discussion"}),(0,n.jsxs)(A.z,{variant:"ghost",size:"sm",className:"text-amber-200 hover:text-amber-100 hover:bg-amber-800/20",onClick:()=>T(!0),children:[(0,n.jsx)(V.Z,{className:"w-4 h-4 mr-1.5"}),"Verify Email"]})]}),(0,n.jsxs)("div",{className:(0,d.cn)("flex items-start gap-3",w?"p-3":"p-2"),children:[w&&(0,n.jsx)("div",{className:"flex-shrink-0 mt-1",children:(0,n.jsx)(r.default,{src:g&&(null==b?void 0:b.profile_image)?null==b?void 0:b.profile_image:"/images/profile-picture.webp",alt:"User Avatar",width:32,height:32,className:"rounded-full object-fill"})}),(0,n.jsxs)("div",{className:"flex-1 w-full",onClick:()=>{E(!0)},children:[w?(0,n.jsx)(R,{onChange:e=>{y(e);let t=document.createElement("div");t.innerHTML=e;let s=(t.textContent||t.innerText||"").length;k(s),S(s>1e3)},onSubmit:I,editable:!0,content:N,placeholder:a?"Write a reply...":"Join the discussion..."}):(0,n.jsx)("div",{className:"px-3 py-2 text-zinc-400 text-sm cursor-text rounded-md",children:"Join the discussion..."}),w&&(0,n.jsx)("div",{className:"border-t border-zinc-800/50 px-3 py-2 flex justify-end",children:(0,n.jsx)(A.z,{onClick:I,disabled:!N.trim(),className:"bg-[#9333ea] hover:bg-[#7928ca] text-white text-sm px-4 py-1.5 rounded-md font-medium disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:a?"Reply":"Comment"})})]})]}),(0,n.jsx)(M,{isOpen:_,onClose:()=>T(!1),email:null==b?void 0:b.email,onVerify:()=>{T(!1)}})]})}var W=s(27619);let U=[{id:"upvote",emoji:"\uD83D\uDC4D",label:"Upvote",count:0},{id:"funny",emoji:"\uD83D\uDE02",label:"Funny",count:0},{id:"love",emoji:"\uD83D\uDE0D",label:"Love",count:0},{id:"surprised",emoji:"\uD83D\uDE2E",label:"Surprised",count:0},{id:"angry",emoji:"\uD83D\uDE20",label:"Angry",count:0},{id:"sad",emoji:"\uD83D\uDE22",label:"Sad",count:0}];var q=e=>{let{metadata:t}=e,[s,a]=(0,l.useState)(U),[i,r]=(0,l.useState)(null),[u,x]=(0,l.useState)(null),[h,p]=(0,l.useState)(!1),[v,f]=(0,l.useState)(0),j=(0,l.useRef)(null),{isLoggedIn:D}=(0,o.a)(),b=t.is_series?"/api/v1/reactions/series/".concat(t.id):"/api/v1/reactions/chapter/".concat(t.id),g=t.is_series?"/api/v1/votes/series/".concat(t.id):"/api/v1/votes/chapter/".concat(t.id),{data:N,isLoading:y}=(0,W.ZP)(D?g:null,c.HT,{revalidateIfStale:!1,revalidateOnFocus:!1,revalidateOnReconnect:!1}),{data:w,isLoading:E}=(0,W.ZP)(b,c.HT,{revalidateIfStale:!0,revalidateOnFocus:!1,revalidateOnReconnect:!0});(0,l.useEffect)(()=>{w&&a(e=>e.map(e=>({...e,count:w.data[e.id]?Number(w.data[e.id]):e.count}))),N&&r(N.data.reaction)},[w,N]),(0,l.useEffect)(()=>{N&&!E&&r(N.data.reaction)},[N,y,E]),(0,l.useEffect)(()=>()=>{j.current&&clearInterval(j.current)},[]);let z=async e=>{if(null!=i){if(i===e){a(t=>t.map(t=>t.id===e?{...t,count:t.count-1}:t)),r(null);return}a(t=>t.map(t=>t.id===e?{...t,count:t.count+1}:t)),a(e=>e.map(e=>e.id===i?{...e,count:e.count-1}:e)),r(e);return}a(t=>t.map(t=>t.id===e?{...t,count:t.count+1}:t)),r(e)},k=e=>{p(!0),f(e),(0,m.A)({title:"Rate limit reached",description:"You can only react 5 times per minute. Please try again in ".concat(e," seconds.")}),j.current=setInterval(()=>{f(e=>(e<=1&&(p(!1),j.current&&clearInterval(j.current)),e-1))},1e3)},C=async e=>{if(!D){alert("Please login to post a reaction.");return}if(!u){x(e);try{await (0,c.a4)(b,{reaction:e}).then(t=>S(t,e),e=>Z(e)).then()}catch(e){r(null),x(null),429===e.status&&setTimeout(()=>{},1e4)}}},S=async(e,t)=>{await z(t),x(null)},Z=e=>{429===e.status&&k(e.response.data.seconds_until_reset),r(null),x(null)},_=s.reduce((e,t)=>e+t.count,0);return E?(0,n.jsxs)("div",{className:"px-4 sm:px-8 pt-6 pb-4 border-b border-zinc-800",children:[(0,n.jsxs)("div",{className:"text-center mb-4",children:[(0,n.jsx)("h2",{className:"text-base font-medium text-zinc-300 mb-1",children:"What do you think?"}),(0,n.jsxs)("div",{className:"flex flex-row justify-center gap-1",children:[(0,n.jsx)(O.Z,{className:"w-5 h-5 animate-spin"}),(0,n.jsx)("p",{className:"text-sm text-zinc-400",children:"Reactions"})]})]}),(0,n.jsx)("div",{className:"grid grid-cols-3 gap-4 sm:flex sm:justify-center sm:gap-16",children:s.map(e=>(0,n.jsxs)("button",{onClick:()=>C(e.id),className:'flex flex-col items-center transition-all duration-200 opacity-90 hover:opacity-100 hover:scale-105"}',children:[(0,n.jsx)("span",{className:"text-4xl mb-2 drop-shadow-md",children:e.emoji}),(0,n.jsx)("span",{className:"text-base font-medium text-zinc-200 mb-0.5",children:(0,n.jsx)(O.Z,{className:"w-5 h-5 animate-spin"})}),(0,n.jsx)("span",{className:"text-xs text-zinc-400",children:e.label})]},e.id))})]}):(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)("div",{className:"px-4 sm:px-8 pt-6 pb-4 border-b border-zinc-800",children:[(0,n.jsxs)("div",{className:"text-center mb-4",children:[(0,n.jsx)("h2",{className:"text-base font-medium text-zinc-300 mb-1",children:"What do you think?"}),_<1&&(0,n.jsx)("p",{className:"text-sm text-zinc-400",children:"No Reactions yet"}),1==_&&(0,n.jsxs)("p",{className:"text-sm text-zinc-400",children:[_," Reaction"]}),_>1&&(0,n.jsxs)("p",{className:"text-sm text-zinc-400",children:[_," Reactions"]})]}),(0,n.jsx)("div",{className:"grid grid-cols-3 gap-4 sm:flex sm:justify-center sm:items-start sm:gap-16",children:s.map(e=>(0,n.jsxs)("button",{onClick:()=>C(e.id),disabled:null!==u||h,className:(0,d.cn)("flex flex-col items-center transition-all duration-200 relative",i===e.id?"opacity-100 scale-110":"opacity-90 hover:opacity-100 hover:scale-105",(null!==u||h)&&"cursor-not-allowed",u!==e.id&&(null!==u||h)&&"opacity-50"),children:[(0,n.jsxs)("div",{className:"flex relative",children:[(0,n.jsx)("span",{className:(0,d.cn)("text-4xl mb-2 filter drop-shadow-md",u===e.id&&"opacity-50"),children:e.emoji}),u===e.id&&(0,n.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,n.jsx)(O.Z,{className:"w-6 h-6 text-white animate-spin"})}),i===e.id&&(0,n.jsxs)("span",{className:"absolute -top-2 -right-2 w-4 h-4 flex items-center justify-center",children:[(0,n.jsx)("span",{className:"absolute inset-0 rounded-full bg-[#9333ea]/20 animate-ping"}),(0,n.jsx)("span",{className:"relative block w-2 h-2 rounded-full bg-[#9333ea]"})]})]}),(0,n.jsx)("span",{className:"text-base font-medium text-zinc-200 mb-0.5",children:u===e.id?"...":e.count}),(0,n.jsx)("span",{className:(0,d.cn)("text-xs text-zinc-400"),children:e.label})]},e.id))}),h&&(0,n.jsxs)("div",{className:"mt-6 text-sm text-amber-400 bg-amber-950/30 border border-amber-900/50 rounded-md px-4 py-2 flex items-center justify-center max-w-md mx-auto",children:[(0,n.jsx)("span",{className:"animate-pulse mr-2",children:"•"}),"Rate limit reached. You can react again in ",v," seconds."]})]})})},X=s(36793),J=s(28076),K=s(80035),$=s(61671),G=s(63544),Q=s(86485),ee=s(1734),et=s(43184),es=s(40366),ea=s(40925),ei=s(19819),en=s(21299),el=s(48878),er=s(20768),ec=s(34763),eo=s(40435),ed=s(50440),eu=s(40674);(a=i||(i={}))[a.like=1]="like",a[a.dislike=-1]="dislike";let em=(0,eu.env)("NEXT_PUBLIC_BACKEND_URL");var ex=e=>{var t,s,a,i,v,f;let{classname:j,comment:D,metadata:b,handleMutate:g,handleDelete:N,canVote:y,canVoteCallback:w,children:E}=e,{mutate:z}=(0,u.kY)(),{user:k,loading:C,isLoggedIn:S}=(0,o.a)(),Z=b.is_series?"/api/v1/comments/series/".concat(b.id):"/api/v1/comments/chapter/".concat(b.id),_=b.is_series?"/api/v1/votes/series/".concat(b.id):"/api/v1/votes/chapter/".concat(b.id),[T,L]=(0,l.useState)(!1),[F,V]=(0,l.useState)(!1),[Y,I]=(0,l.useState)(!1),[P,B]=(0,l.useState)(!1),[M,W]=(0,l.useState)(D.body),[U,q]=(0,l.useState)(D.body),[X,eu]=(0,l.useState)(0),[ex,eh]=(0,l.useState)(!1),[ep,ev]=(0,l.useState)(!1),[ef,ej]=(0,l.useState)(!1),[eD,eb]=(0,l.useState)(!1),[eg,eN]=(0,l.useState)(0),[ey,ew]=(0,l.useState)(0),[eE,ez]=(0,l.useState)(!1),[ek,eC]=(0,l.useState)(!1),[eS,eZ]=(0,l.useState)(null),e_=()=>{L(!0)},eT=async(e,t)=>{if(null===eS){switch(t){case 1:ez(!0),await eL(e,1)&&(eZ(t),eN(e=>e+1));break;case -1:eC(!0),await eL(e,-1)&&(eZ(t),ew(e=>e+1))}return}if(eS===t){switch(t){case 1:ez(!0),await eR(e,1)&&(eZ(null),eN(e=>e-1));break;case -1:eC(!0),await eR(e,-1)&&(eZ(null),ew(e=>e-1))}return}switch(t){case 1:ez(!0),eC(!0),await eL(e,-1)?(eZ(t),eN(e=>e+1),ew(e=>e-1)):setTimeout(()=>{w(!0)},1e4);break;case -1:ez(!0),eC(!0),await eL(e,1)&&(eZ(t),eN(e=>e-1),ew(e=>e+1))}};(0,l.useEffect)(()=>{eN(D.likes_count),ew(D.dislikes_count),null!==D.userVote&&(1===D.userVote&&eZ(1),-1===D.userVote&&eZ(-1));let e=document.createElement("div");e.innerHTML=D.body;let t=(e.textContent||e.innerText||"").length;eu(t),ej(t>300)},[C,D.body]);let eL=async(e,t)=>{try{return w(!1),setTimeout(async()=>{try{return await (0,c.a4)("/api/v1/votes/"+e,{comment_id:D.id,vote:t}),ez(!1),eC(!1),!0}catch(e){429===e.status?(p(),setTimeout(()=>{w(!0)},1e4)):h()}return ez(!1),eC(!1),!1},1e3),setTimeout(()=>{w(!0)},1e3),!0}catch(e){return 429===e.status?(p(),setTimeout(()=>{w(!0)},1e4)):h(),!1}},eR=async(e,t)=>{try{return w(!1),setTimeout(async()=>{try{return await (0,c.yY)("/api/v1/votes/"+e,{comment_id:D.id,vote:t}),ez(!1),eC(!1),setTimeout(()=>{w(!0)},1e3),!0}catch(e){return 429===e.status?(setTimeout(()=>{w(!0)},1e4),p()):h(),ez(!1),eC(!1),!1}},1e3),!0}catch(e){return ez(!1),eC(!1),429===e.status?(setTimeout(()=>{w(!0)},1e4),p()):h(),!1}},eA=async e=>{try{let t=await (0,c.ji)("/api/v1/admin/comments/".concat(e));if(t.ok){x("Comment deleted","User's comment has been deleted"),N(e);return}if(t.bad){if(t.ratelimited){p();return}h()}}catch(e){console.log(e)}},eF=async e=>{try{let t=await (0,c.LN)("/api/v1/admin/comments/user/".concat(e));if(t.ok){x("User banned from commenting","User can no longer post or update comments on any series/chapter","",5e3);return}if(t.bad){if(t.badinput){x("Error",t.body.message,"font-bold text-red-400",5e3);return}if(t.forbidden){x("Not Allowed",t.body.message,"font-bold text-red-400",5e3);return}if(t.ratelimited){p();return}h()}}catch(e){console.log(e)}},eV=async()=>{try{let e=await (0,c.ji)("/api/v1/comments/".concat(D.id));if(e.ok){x("Comment Deleted","Your comment has been deleted"),N(D.id);return}if(e.bad){if(e.ratelimited){p();return}h()}}catch(e){console.log(e)}},eY=async()=>{try{let e=await (0,c.LN)("/api/v1/comments",{id:D.id,body:U});if(e.ok){L(!1),W(U),(0,m.A)({title:"Comment updated",description:(0,n.jsx)("div",{children:(0,n.jsx)("span",{className:"",children:"Your comment has been update, it may take a couple of seconds for it to reflect"})}),duration:3e3}),setTimeout(async()=>{await z(_),await z(Z)},3e3);return}if(e.bad){if(e.badinput){x("400: Bad Input",e.body.message);return}if(e.ratelimited){p();return}}}catch(e){console.log(e)}},eI=(()=>{try{var e,t;return null!==(t=null==D?void 0:null===(e=D.user)||void 0===e?void 0:e.premium)&&void 0!==t&&t}catch(e){return!1}})(),eO=(()=>{try{var e,t;return null!==(t=null==D?void 0:null===(e=D.user)||void 0===e?void 0:e.name)&&void 0!==t?t:"Commenter"}catch(e){return"Commenter"}})();return(0,n.jsxs)("div",{className:(0,d.cn)("py-4",j),children:[(0,n.jsxs)("div",{className:(0,d.cn)("flex",D.is_reply&&"pl-8 sm:pl-12"),children:[(0,n.jsx)("div",{className:"flex-shrink-0 mr-3",children:(0,n.jsx)("div",{className:"relative",children:(0,n.jsx)("div",{className:(0,d.cn)("rounded-full overflow-hidden",eI&&"ring-2 ring-purple-500/50 ring-offset-1 ring-offset-zinc-900"),children:(0,n.jsx)(r.default,{src:(()=>{try{var e;return(null==D?void 0:null===(e=D.user)||void 0===e?void 0:e.profile_image)?"".concat(em,"/storage/").concat(D.user.profile_image):"/images/profile-picture.webp"}catch(e){return"".concat(em,' + "/images/profile-picture.webp"')}})(),alt:"",width:40,height:40,className:"rounded-full w-8 h-8 sm:w-10 sm:h-10"})})})}),(0,n.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,n.jsxs)("div",{className:"flex items-center flex-wrap gap-2 mb-1",children:[(0,n.jsx)("div",{className:(0,d.cn)("font-semibold transition-colors",eI?"text-purple-300 hover:text-purple-200":"text-white hover:text-[#9333ea]"),children:eO}),eI&&(0,n.jsx)("div",{className:"bg-gradient-to-r from-yellow-400 to-yellow-600 text-black text-[10px] px-1.5 py-0.5 rounded-full font-bold",children:"ASURA+"}),(0,n.jsx)("span",{className:"text-xs text-zinc-400",children:(0,er.Z)(new Date(D.created_at),{addSuffix:!0})})]}),(0,n.jsx)("div",{className:(0,d.cn)("text-sm leading-relaxed mb-3",T?"bg-zinc-900/50 rounded-lg border border-zinc-800 p-2 sm:p-4 gap-3":""),children:T?(0,n.jsxs)("div",{className:"mb-2",children:[(0,n.jsx)(R,{onChange:e=>{q(e);let t=document.createElement("div");t.innerHTML=e,eh((t.textContent||t.innerText||"").length>1e3)},onSubmit:eY,editable:!0,content:U,placeholder:"Write a reply..."}),(0,n.jsxs)("div",{className:"flex items-center justify-end gap-2 mt-2",children:[(0,n.jsxs)(A.z,{size:"sm",variant:"outline",onClick:()=>{L(!1)},className:"h-8 px-3 text-xs border-zinc-700 text-zinc-300 hover:bg-zinc-700 hover:text-white",children:[(0,n.jsx)(J.Z,{className:"w-3.5 h-3.5 mr-1"}),"Cancel"]}),(0,n.jsxs)(A.z,{size:"sm",onClick:eY,disabled:ex,className:"h-8 px-3 text-xs bg-[#9333ea] hover:bg-[#7928ca] text-white disabled:opacity-50",children:[(0,n.jsx)(K.Z,{className:"w-3.5 h-3.5 mr-1"}),"Save"]})]}),ex&&(0,n.jsx)("div",{className:"mt-2 text-xs text-red-400 bg-red-950/20 border border-red-900/30 rounded-md px-3 py-2",children:"Your comment exceeds the 1000 character limit. Please shorten it to save."})]}):(0,n.jsxs)("div",{className:"mb-2",children:[(0,n.jsx)("div",{className:(0,d.cn)("prose prose-invert prose-sm max-w-none",eI?"text-zinc-100":"text-zinc-200"),dangerouslySetInnerHTML:{__html:(()=>{if(!ef||ep)return M;let e=document.createElement("div");e.innerHTML=M;let t=(e.textContent||e.innerText||"").substring(0,300)+"...";return"<p>".concat(t,"</p>")})()},style:{overflow:"hidden",overflowWrap:"anywhere",wordBreak:"normal",hyphens:"none"}}),ef&&(0,n.jsx)("button",{onClick:()=>{ev(!ep)},className:"mt-1 text-xs flex items-center gap-1 text-[#9333ea] hover:text-[#7928ca] transition-colors",children:ep?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)($.Z,{className:"w-3.5 h-3.5"}),(0,n.jsx)("span",{children:"Show less"})]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(G.Z,{className:"w-3.5 h-3.5"}),(0,n.jsxs)("span",{children:["Read more (",X," characters)"]})]})})]})}),!T&&(0,n.jsxs)("div",{className:"flex items-center gap-4 text-xs",children:[!S&&(0,n.jsx)(ed.u,{id:"login-required"}),(0,n.jsxs)("button",{onClick:()=>eT(D.id,1),disabled:!S||!y,"data-tooltip-id":"login-required","data-tooltip-content":"Login to like this comment",className:(0,d.cn)("flex items-center gap-1.5 transition-colors",1===eS?"text-purple-400":"text-zinc-400",y&&"hover:text-[#9333ea]"),children:[(0,n.jsx)(Q.Z,{className:"w-3.5 h-3.5"}),eE?(0,n.jsx)(O.Z,{className:"w-3 h-3 animate-spin"}):(0,n.jsx)("span",{children:eg})]}),(0,n.jsxs)("button",{onClick:()=>eT(D.id,-1),disabled:!S||!y,"data-tooltip-id":"login-required","data-tooltip-content":"Login to dislike this comment",className:(0,d.cn)("flex items-center gap-1.5 transition-colors",-1===eS?"text-purple-400":"text-zinc-400",y&&"hover:text-[#9333ea]"),children:[(0,n.jsx)(ee.Z,{className:"w-3.5 h-3.5"}),ek?(0,n.jsx)(O.Z,{className:"w-3 h-3 animate-spin"}):(0,n.jsx)("span",{children:ey})]}),!D.is_reply&&(0,n.jsxs)("button",{onClick:()=>{eb(!eD)},disabled:!S,"data-tooltip-id":"login-required","data-tooltip-content":"Login to reply to this comment",className:(0,d.cn)("flex items-center gap-1.5 text-zinc-400 hover:text-[#9333ea] transition-colors"),children:[(0,n.jsx)(et.Z,{className:"w-4 h-4"}),"Reply"]}),S&&(null==D?void 0:null===(t=D.user)||void 0===t?void 0:t.id)===(null==k?void 0:k.id)&&(0,n.jsxs)("button",{onClick:e_,className:"flex items-center gap-1.5 text-zinc-400 hover:text-[#9333ea] transition-colors",children:[(0,n.jsx)(es.Z,{className:"w-3.5 h-3.5"}),(0,n.jsx)("span",{className:"hidden sm:inline",children:"Edit"})]}),S&&(0,n.jsxs)(ec.h_,{modal:!1,children:[(0,n.jsx)(ec.$F,{asChild:!0,children:(0,n.jsx)(A.z,{variant:"ghost",size:"icon",className:"h-6 w-6 p-0 text-zinc-400 hover:text-white hover:bg-transparent",children:(0,n.jsx)(ea.Z,{className:"h-4 w-4"})})}),(0,n.jsxs)(ec.AW,{align:"end",className:"bg-zinc-900 border-zinc-800",children:[S&&(null==D?void 0:null===(s=D.user)||void 0===s?void 0:s.id)&&(null==k?void 0:k.id)&&(null==D?void 0:null===(a=D.user)||void 0===a?void 0:a.id)===(null==k?void 0:k.id)&&(0,n.jsxs)(ec.Xi,{onClick:e_,className:"text-zinc-300 focus:text-zinc-100 focus:bg-zinc-800",children:[(0,n.jsx)(es.Z,{className:"w-4 h-4 mr-2"}),(0,n.jsx)("span",{children:"Edit Comment"})]}),S&&(null==D?void 0:null===(i=D.user)||void 0===i?void 0:i.id)&&(null==k?void 0:k.id)&&(null==D?void 0:null===(v=D.user)||void 0===v?void 0:v.id)===(null==k?void 0:k.id)&&(0,n.jsxs)(ec.Xi,{onClick:eV,className:"text-zinc-300 focus:text-zinc-100 focus:bg-zinc-800",children:[(0,n.jsx)(es.Z,{className:"w-4 h-4 mr-2"}),(0,n.jsx)("span",{children:"Delete Comment"})]}),(0,n.jsxs)(ec.Xi,{className:"text-red-400 focus:text-red-400 focus:bg-red-400/10",children:[(0,n.jsx)(ei.Z,{className:"w-4 h-4 mr-2"}),"Report"]}),S&&(null==k?void 0:null===(f=k.flags)||void 0===f?void 0:f.moderator)&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(ec.VD,{}),(0,n.jsxs)(ec.Ph,{children:[(0,n.jsx)(ec.kt,{className:"text-red-400 focus:text-red-400 focus:bg-red-400/10",children:"Moderation"}),(0,n.jsx)(ec.cq,{children:(0,n.jsxs)(ec.TG,{className:"bg-zinc-900 border-zinc-800",children:[(0,n.jsxs)(ec.Xi,{onClick:()=>{B(!0)},className:"text-red-400 focus:text-red-400 focus:bg-red-400/10",children:[(0,n.jsx)(en.Z,{className:"w-4 h-4 mr-2"}),(0,n.jsx)("span",{children:"Delete comment"})]}),(0,n.jsx)(ec.VD,{}),(0,n.jsxs)(ec.Xi,{onClick:()=>{I(!0)},className:"text-red-400 focus:text-red-400 focus:bg-red-400/10",children:[(0,n.jsx)(el.Z,{className:"w-4 h-4 mr-2"}),(0,n.jsx)("span",{children:"Ban User"})]})]})})]})]})]})]})]}),eD&&(0,n.jsx)("div",{className:"ml-0 sm:ml-12 mt-3",children:(0,n.jsx)(H,{metadata:b,is_reply:!0,parent_id:D.id,onSubmitCallback:()=>{eb(!1)}})})]}),(0,n.jsx)(eo.aR,{open:Y,onOpenChange:()=>{I(!1)},children:(0,n.jsxs)(eo.zJ,{children:[(0,n.jsx)(eo.dh,{className:"fixed inset-0 bg-primary-700 data-[state=open]:animate-overlayShow"}),(0,n.jsxs)(eo._T,{className:"fixed left-1/2 top-1/2 max-h-[85vh] w-[90vw] max-w-[500px] bg-[#222222] -translate-x-1/2 -translate-y-1/2 rounded-md p-[25px] shadow-[var(--shadow-6)] focus:outline-none data-[state=open]:animate-contentShow",children:[(0,n.jsxs)(eo.f$,{className:"m-0 text-[17px] font-medium",children:["Ban user from commenting: ",eO]}),(0,n.jsx)(eo.yT,{className:"mb-5 mt-[15px] text-[15px] leading-normal",children:"Are you sure?"}),(0,n.jsxs)("div",{className:"flex justify-end gap-[25px]",children:[(0,n.jsx)(eo.le,{asChild:!0,children:(0,n.jsx)(A.z,{variant:"default",children:"Cancel"})}),(0,n.jsx)(eo.OL,{asChild:!0,children:(0,n.jsx)(A.z,{variant:"destructive",onClick:()=>{eF(D.user.id).then()},children:"Yes, ban user from commenting"})})]})]})]})}),(0,n.jsx)(eo.aR,{open:P,onOpenChange:()=>{B(!1)},children:(0,n.jsxs)(eo.zJ,{children:[(0,n.jsx)(eo.dh,{className:"fixed inset-0 bg-primary-700 data-[state=open]:animate-overlayShow"}),(0,n.jsxs)(eo._T,{className:"fixed left-1/2 top-1/2 max-h-[85vh] w-[90vw] max-w-[500px] bg-[#222222] -translate-x-1/2 -translate-y-1/2 rounded-md p-[25px] shadow-[var(--shadow-6)] focus:outline-none data-[state=open]:animate-contentShow",children:[(0,n.jsx)(eo.f$,{className:"m-0 text-[17px] font-medium",children:"Delete comment"}),(0,n.jsx)(eo.yT,{className:"mb-5 mt-[15px] text-[15px] leading-normal",children:"Are you sure?"}),(0,n.jsxs)("div",{className:"flex justify-end gap-[25px]",children:[(0,n.jsx)(eo.le,{asChild:!0,children:(0,n.jsx)(A.z,{variant:"default",children:"Cancel"})}),(0,n.jsx)(eo.OL,{asChild:!0,children:(0,n.jsx)(A.z,{variant:"destructive",onClick:()=>{eA(D.id).then()},children:"Yes, delete comment"})})]})]})]})})]}),E]})};let eh=e=>{let{}=e;return(0,n.jsx)("div",{className:"group py-4",children:Array.from({length:5},(e,t)=>(0,n.jsx)("div",{className:"relative rounded-lg px-3 py-2",children:(0,n.jsxs)("div",{className:"flex flex-col",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,n.jsx)(X.O,{className:"rounded-full w-8 h-8 sm:w-10 sm:h-10"}),(0,n.jsx)(X.O,{className:"rounded-full w-40 h-4 sm:w-20 sm:h-4"}),(0,n.jsx)(X.O,{className:"rounded-full w-20 h-4 sm:w-20 sm:h-4"})]}),(0,n.jsxs)("div",{className:"flex flex-col ml-0 sm:ml-12 gap-2",children:[(0,n.jsx)(X.O,{className:"relative rounded-lg px-3 py-2"}),(0,n.jsx)(X.O,{className:"relative rounded-lg px-3 py-2"}),(0,n.jsx)(X.O,{className:"relative rounded-lg px-3 py-2"})]})]})},t))})};var ep=e=>{let{metadata:t}=e,{mutate:s}=(0,u.kY)(),[a,i]=(0,l.useState)("best"),[r,d]=(0,l.useState)([]),[m,x]=(0,l.useState)(15),[h,p]=(0,l.useState)(),[v,f]=(0,l.useState)(0),[j,D]=(0,l.useState)(!0),[b,g]=(0,l.useState)(!1),[N,y]=(0,l.useState)(!1),[w,E]=(0,l.useState)(!0),{isLoggedIn:z}=(0,o.a)(),k=t.is_series?"/api/v1/comments/series/".concat(t.id):"/api/v1/comments/chapter/".concat(t.id),C=t.is_series?"/api/v1/votes/series/".concat(t.id):"/api/v1/votes/chapter/".concat(t.id),{data:S,isLoading:Z}=(0,W.ZP)(k,c.HT,{revalidateIfStale:!1,revalidateOnFocus:!1,revalidateOnReconnect:!1}),{data:_,isLoading:T}=(0,W.ZP)(z?C:null,c.HT,{revalidateIfStale:!1,revalidateOnFocus:!1,revalidateOnReconnect:!1}),L=e=>{R(e)},R=e=>{d(t=>t.filter(t=>t.id!==e))};(0,l.useEffect)(()=>{S&&!Z&&setTimeout(()=>{D(!1),f(S.data.meta.total),d(S.data.data),y(S.data.data.length>m)},500)},[S,m]);let F=()=>{S&&!Z&&(f(S.data.meta.total),d(S.data.data))};(0,l.useEffect)(()=>{_&&!Z&&p(_.data.votes)},[_,T,Z]);let V=[...r].sort((e,t)=>{switch(a){case"best":return t.likes_count-t.dislikes_count-(e.likes_count-e.dislikes_count);case"newest":return new Date(t.created_at).getTime()-new Date(e.created_at).getTime();case"oldest":return new Date(e.created_at).getTime()-new Date(t.created_at).getTime()}}),Y=e=>{var t;return{...e,userVote:(null==h?void 0:null===(t=h.find(t=>t.comment_id===e.id))||void 0===t?void 0:t.vote)||0,replies:e.replies?e.replies.map(Y):[]}},I=V.slice(0,m).map(Y),P=async()=>{await s(k),F()};return(0,n.jsx)("div",{className:"max-w-4xl mx-auto",children:(0,n.jsxs)("div",{className:"rounded-lg overflow-hidden",children:[(0,n.jsx)(q,{metadata:t}),(0,n.jsxs)("div",{className:"px-4 sm:px-6",children:[(0,n.jsxs)("div",{className:"py-4 flex items-center justify-between",children:[(0,n.jsxs)("span",{className:"text-base font-medium text-zinc-200",children:[v," Comments"]}),(0,n.jsx)("div",{className:"flex text-xs bg-zinc-800/80 rounded-full p-1",children:["best","newest","oldest"].map(e=>(0,n.jsx)("button",{onClick:()=>i(e),className:"px-4 py-1.5 capitalize rounded-full transition-all duration-200 ".concat(a===e?"bg-[#9333ea] text-white font-medium":"text-zinc-300 hover:text-white hover:bg-zinc-700"),children:e},e))})]}),(0,n.jsx)("div",{className:"py-4",children:(0,n.jsx)(H,{metadata:t,handleMutate:P})}),Z||j?(0,n.jsx)(eh,{}):(0,n.jsx)("div",{className:"space-y-0 divide-y divide-zinc-800/30",children:I.map(e=>(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(ex,{comment:e,metadata:t,handleMutate:P,handleDelete:e=>L(e),canVote:w,canVoteCallback:e=>E(e),children:e.replies&&e.replies.map(e=>(0,n.jsx)(ex,{classname:"mt-3 space-y-3 border-l-2 border-zinc-800/30 ml-5",comment:e,metadata:t,handleMutate:P,handleDelete:e=>L(e),canVote:w,canVoteCallback:e=>E(e)},e.id))},e.id)}))}),b?(0,n.jsx)(eh,{}):(0,n.jsx)(n.Fragment,{}),N&&(0,n.jsx)("div",{className:"py-6 text-center",children:(0,n.jsxs)(A.z,{onClick:()=>{g(!0),setTimeout(()=>{x(e=>Math.min(e+15,r.length)),g(!1),y(m+15<r.length)},300)},disabled:b,className:"bg-[#9333ea] hover:bg-[#7928ca] text-white font-medium px-6 py-2 rounded-lg transition-colors",children:["Load More Comments",b&&(0,n.jsx)(O.Z,{className:"ml-2 w-5 h-5 animate-spin"})]})})]})]})})}},57621:function(e,t,s){var a=s(80888),i=s(61524),n=s(69226);t.default=e=>{let{series_slug:t,chapter:s}=e,l=(0,n.useRouter)(),r=(0,a.useCallback)(async()=>{try{await (0,i.a4)("/api/views/collect",{series_slug:t,chapter:s})}catch(e){if("under maintenance"==e)return l.replace("/error/".concat(503));if("Bad Gateway"==e)return l.replace("/error/".concat(502))}},[t,s]);return(0,a.useEffect)(()=>{r()},[r]),null}},36793:function(e,t,s){s.d(t,{O:function(){return n}});var a=s(68247),i=s(58023);function n(e){let{className:t,...s}=e;return(0,a.jsx)("div",{className:(0,i.cn)("animate-pulse rounded-md bg-muted",t),...s})}}}]);