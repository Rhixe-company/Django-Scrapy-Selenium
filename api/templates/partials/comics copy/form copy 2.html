{% load static i18n widget_tweaks example %}

<div id="form-container" class="p-2">
  <div x-data="{ isExpanded: false }"
       class="w-full divide-y divide-neutral-300 overflow-hidden rounded-md border border-neutral-300 bg-neutral-50/40 text-neutral-600 dark:divide-neutral-700 dark:border-neutral-700 dark:bg-neutral-900/50 dark:text-neutral-300">
    <div class="divide-y divide-neutral-300 dark:divide-neutral-700">
      <button id="controlsAccordionItemOne"
              type="button"
              class="flex w-full items-center justify-between gap-4 bg-neutral-50 p-4 text-left underline-offset-2 hover:bg-neutral-50/75 focus-visible:bg-neutral-50/75 focus-visible:underline focus-visible:outline-none dark:bg-neutral-900 dark:hover:bg-neutral-900/75 dark:focus-visible:bg-neutral-900/75"
              aria-controls="accordionItemOne"
              @click="isExpanded = ! isExpanded"
              :class="isExpanded ? 'text-onSurfaceStrong dark:text-onSurfaceDarkStrong font-bold'  : 'text-onSurface dark:text-onSurfaceDark font-medium'"
              :aria-expanded="isExpanded ? 'true' : 'false'">
        Comics
        <svg xmlns="http://www.w3.org/2000/svg"
             viewBox="0 0 24 24"
             fill="none"
             stroke-width="2"
             stroke="currentColor"
             class="size-5 shrink-0 transition"
             aria-hidden="true"
             :class="isExpanded  ?  'rotate-180'  :  ''">
          <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 8.25l-7.5 7.5-7.5-7.5" />
        </svg>
      </button>
      <div x-cloak
           x-show="isExpanded"
           id="accordionItemOne"
           role="region"
           aria-labelledby="controlsAccordionItemOne"
           x-collapse>
        <form class="p-1"
              action='.'
              method="POST"
              class='space-y-2 mb-2  mx-auto'
              hx-swap="outerHTML"
              hx-target='#form-container'
              hx-indicator='#spinner'
              hx-post='.'
              {% if form.instance.id %} hx-trigger='submit, change delay:500ms' {% else %} hx-trigger='submit' {% endif %}>
          {% csrf_token %}
          <div class="grid gap-1 mb-1 grid-cols-2">
            <div class="col-span-2 sm:col-span-1">
              <label for="{{ form.title.name }}" class="custom_label">{{ form.title.label }}</label>
              {{ form.title|add_classes:'custom_char_input' }}
              <div class="mt-1 text-gray-500">{{ form.title.help_text|safe }}</div>
              <div class="ml-3 text-xs text-red-400">{{ form.title.errors }}</div>
            </div>
            <div class="col-span-2 sm:col-span-1">
              <label for="{{ form.status.name }}" class="custom_label">{{ form.status.label }}</label>
              {{ form.status|add_classes:'custom_select_input' }}
              <div class="mt-1 text-gray-500">{{ form.status.help_text|safe }}</div>
              <div class="ml-3 text-xs text-red-400">{{ form.status.errors }}</div>
            </div>
            <div class="col-span-2 sm:col-span-1">
              <label for="{{ form.type.name }}" class="custom_label">{{ form.type.label }}</label>
              {{ form.type|add_classes:'custom_select_input' }}
              <div class="mt-1 text-gray-500">{{ form.type.help_text|safe }}</div>
              <div class="ml-3 text-xs text-red-400">{{ form.type.errors }}</div>
            </div>
            <div class="col-span-2 sm:col-span-1">
              <label for="{{ form.artist.name }}" class="custom_label">{{ form.artist.label }}</label>
              {{ form.artist|add_classes:'custom_select_input' }}
              <div class="mt-1 text-gray-500">{{ form.artist.help_text|safe }}</div>
              <div class="ml-3 text-xs text-red-400">{{ form.artist.errors }}</div>
            </div>
            <div class="col-span-2 sm:col-span-1">
              <label for="{{ form.author.name }}" class="custom_label">{{ form.author.label }}</label>
              {{ form.author|add_classes:'custom_select_input' }}
              <div class="mt-1 text-gray-500">{{ form.author.help_text|safe }}</div>
              <div class="ml-3 text-xs text-red-400">{{ form.author.errors }}</div>
            </div>
            <div class="col-span-2 sm:col-span-1">
              <label for="{{ form.rating.name }}" class="custom_label">{{ form.rating.label }}</label>
              {{ form.rating|add_classes:'custom_char_input' }}
              <div class="mt-1 text-gray-500">{{ form.rating.help_text|safe }}</div>
              <div class="ml-3 text-xs text-red-400">{{ form.rating.errors }}</div>
            </div>
            <div class="col-span-2 sm:col-span-1">
              <label for="{{ form.description.name }}" class="custom_label">{{ form.description.label }}</label>
              {{ form.description|add_classes:'custom_textarea_input' }}
              <div class="mt-1 text-gray-500">{{ form.description.help_text|safe }}</div>
              <div class="ml-3 text-xs text-red-400">{{ form.description.errors }}</div>
            </div>
            <div class="col-span-2 sm:col-span-1">
              <label for="{{ form.updated_at.name }}" class="custom_label">{{ form.updated_at.label }}</label>
              {{ form.updated_at|add_classes:'custom_char_input' }}
              <div class="mt-1 text-gray-500">{{ form.updated_at.help_text|safe }}</div>
              <div class="ml-3 text-xs text-red-400">{{ form.updated_at.errors }}</div>
            </div>
            <div class="col-span-2 sm:col-span-1">
              <label for="{{ form.url.name }}" class="custom_label">{{ form.url.label }}</label>
              {{ form.url|add_classes:'custom_char_input' }}
              <div class="mt-1 text-gray-500">{{ form.url.help_text|safe }}</div>
              <div class="ml-3 text-xs text-red-400">{{ form.url.errors }}</div>
            </div>
            <div class="col-span-2 sm:col-span-1">
              <label for="{{ form.spider.name }}" class="custom_label">{{ form.spider.label }}</label>
              {{ form.spider|add_classes:'custom_char_input' }}
              <div class="mt-1 text-gray-500">{{ form.spider.help_text|safe }}</div>
              <div class="ml-3 text-xs text-red-400">{{ form.spider.errors }}</div>
            </div>
            <div class="col-span-2 sm:col-span-1">
              <label for="{{ form.serialization.name }}" class="custom_label">{{ form.serialization.label }}</label>
              {{ form.serialization|add_classes:'custom_char_input' }}
              <div class="mt-1 text-gray-500">{{ form.serialization.help_text|safe }}</div>
              <div class="ml-3 text-xs text-red-400">{{ form.serialization.errors }}</div>
            </div>
            <div class="col-span-2 sm:col-span-1">
              <label for="{{ form.genres.name }}" class="custom_label">{{ form.genres.label }}</label>
              {{ form.genres|add_classes:'custom_mulselect_input' }}
              <div class="mt-1 text-gray-500">{{ form.genres.help_text|safe }}</div>
              <div class="ml-3 text-xs text-red-400">{{ form.genres.errors }}</div>
            </div>
          </div>
          {% include "partials/htmx/spinner.html" %}
          <!-- Dialog Footer -->
          <div class="flex flex-col-reverse justify-between gap-2 border-t border-neutral-300 bg-neutral-50/60 p-4 dark:border-neutral-700 dark:bg-neutral-950/20 sm:flex-row sm:items-center md:justify-end">
            <button href='{% url "comics:comic_list" %}'
                    hx-get='{% url "comics:comic_list" %}'
                    hx-swap="outerHTML"
                    hx-target='#form-container'
                    hx-indicator='#spinner'
                    hx-replace-url='true'
                    type="button"
                    class="cursor-pointer whitespace-nowrap rounded-md px-4 py-2 text-center text-sm font-medium tracking-wide text-neutral-600 transition hover:opacity-75 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-black active:opacity-100 active:outline-offset-0 dark:text-neutral-300 dark:focus-visible:outline-white">
              Go back
            </button>
            <button type="submit"
                    class="cursor-pointer whitespace-nowrap rounded-md bg-black px-4 py-2 text-center text-sm font-medium tracking-wide text-neutral-100 transition hover:opacity-75 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-black active:opacity-100 active:outline-offset-0 dark:bg-white dark:text-black dark:focus-visible:outline-white">
              Submit
            </button>
          </div>
        </form>
      </div>
    </div>
    {% if form.instance.id %}
      {% with images=object.get_comic_images_children %}
        <div class="divide-y divide-neutral-300 dark:divide-neutral-700">
          <button id="controlsAccordionItemTwo"
                  type="button"
                  class="flex w-full items-center justify-between gap-4 bg-neutral-50 p-4 text-left underline-offset-2 hover:bg-neutral-50/75 focus-visible:bg-neutral-50/75 focus-visible:underline focus-visible:outline-none dark:bg-neutral-900 dark:hover:bg-neutral-900/75 dark:focus-visible:bg-neutral-900/75"
                  aria-controls="accordionItemTwo"
                  @click="isExpanded = ! isExpanded"
                  :class="isExpanded ? 'text-onSurfaceStrong dark:text-onSurfaceDarkStrong font-bold'  : 'text-onSurface dark:text-onSurfaceDark font-medium'"
                  :aria-expanded="isExpanded ? 'true' : 'false'">
            Comic Images
            <svg xmlns="http://www.w3.org/2000/svg"
                 viewBox="0 0 24 24"
                 fill="none"
                 stroke-width="2"
                 stroke="currentColor"
                 class="size-5 shrink-0 transition"
                 aria-hidden="true"
                 :class="isExpanded  ?  'rotate-180'  :  ''">
              <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 8.25l-7.5 7.5-7.5-7.5" />
            </svg>
          </button>
          <div x-cloak
               x-show="isExpanded"
               id="accordionItemTwo"
               role="region"
               aria-labelledby="controlsAccordionItemTwo"
               x-collapse>
            <div class="p-4 text-sm sm:text-base text-pretty">
              <div class="flow-root mb-2">
                <ul role="list" class="divide-y divide-gray-200 dark:divide-gray-700">
                  {% for img in images %}
                    {% include "partials/comics/images-inline.html" with object=img %}
                  {% empty %}
                    <span class="mr-2 rounded-md border border-red-100 bg-red-100 px-2.5 py-0.5 text-xs font-medium text-red-800 dark:border-red-500 dark:bg-gray-700 dark:text-red-400">No Comic Images...</span>
                  {% endfor %}
                </ul>
              </div>
              {% if new_comic_image_url %}
                <div id='comic-create'></div>
                <button class='w-1/2 px-3 py-2 text-sm font-medium text-center text-white rounded-lg bg-primary-700 hover:bg-primary-800 focus:ring-4 focus:ring-primary-300 sm:w-auto dark:bg-primary-600 dark:hover:bg-primary-700 dark:focus:ring-primary-800'
                        href="{{ new_comic_image_url }}"
                        hx-get="{{ new_comic_image_url }}"
                        hx-target='#comic-create'
                        hx-indicator='#spinner'
                        hx-swap='beforeend'>{% translate "Add New Comic Image Form" %}</button>
              {% endif %}
            </div>
          </div>
        </div>
      {% endwith %}
    {% endif %}
  </div>
</div>
