window.pubadxtag = function () {
    function b(t, e, n, o, j) {
        const w = document.createElement("div");
        w.setAttribute("id", e.id + "-1");
        const i = document.createElement("iframe");
        i.setAttribute("frameborder", "0");
        i.setAttribute("id", `iframe_${t}`);
        i.setAttribute("name", `iframe_${t}`);
        i.setAttribute("allowfullscreen", "true");
        i.setAttribute("margin", "auto");
        i.setAttribute("width", "100%");
        i.setAttribute("onload", 'javascript:(function(o){setTimeout(function() {o.style.height=o.contentWindow.document.body.scrollHeight+"px";o.style.width=o.contentWindow.document.body.scrollWidth+"px";}, 500);}(this));');
        if (o === 1) {
            i.setAttribute("height", "auto");
        } else {
            i.setAttribute("height", o || "0");
        }
        i.setAttribute("scrolling", "no");
        w.appendChild(i);
        let dClose = document.getElementById(`close-${e.id}-close`);
        if (dClose) {
            w.appendChild(dClose);
        }
        e.appendChild(w);
        if (j.data.cssOutPartner) {
            const c = document.createElement("style");
            c.innerText = j.data.cssOutPartner;
            w.appendChild(c);
        }

        const a = i.contentWindow ? i.contentWindow : i.contentDocument.document ? i.contentDocument.document : i.contentDocument;
        a.document.open();
        a.document.write(n);
        a.document.close();
        if (a.document.body && !a.document.body.isContentEditable) {
            a.document.body.contentEditable = true;
            a.document.body.contentEditable = false;
            a.document.body.style.padding = 0;
            a.document.body.style.margin = 0;
            a.document.body.style.overflow = "hidden"
        }
    }

    function g(e) {
        if (e.nodeType !== 1) {
            return e.cloneNode(true)
        }
        const n = document.createElement(e.tagName);
        for (let t = 0; t < e.attributes.length; t++) {
            n.setAttribute(e.attributes[t].nodeName, e.attributes[t].nodeValue)
        }
        const {childNodes: o} = e;
        for (let t = 0; t < o.length; t++) {
            const i = o[t];
            n.appendChild(g(i))
        }
        return n
    }


    async function h(zoneid, wu) {
        try {
            const k = new Date().getTime();
            const s = await fetch(`https://platform.pubadx.one/async-v2.json?zoneid=${zoneid}&wu=${wu}`);
            const d = await s.json();
            if (s.status !== 200) {
                console.log(d.message)
            }
            return d
        } catch (t) {
            console.log(t)
        }
    }


    async function e(n) {
        if (!n) return console.log("Tag not found");
        const o = document.getElementById(n.id);
        if (!o) return console.log(`div ${n.id || ""} not found`);
        if (y.indexOf(n.id) !== -1) {
            return console.error(`Div element ${n.id} is already associated with another slot`)
        }
        y.push(n.id);
        const i = await h(n.zoneid, n.wu);
        if (!(i && i.data)) {
            return;
        }
        const {width: t, height: l} = i.data.size;

        o.style.position = "relative";
        o.style.margin = "auto";
        o.style.clear = "both";
        if (t > 2) {
            o.style.width = `${t}px`;
        }
        const a = i.data;

        x(i.data.useIframe, n.id, o, i.data.htmlCode, l, a, i, n)
        if (i.data.auRefresh) {
            let refreshIframe = i.data.refreshIframe || 1;
            setInterval(function () {
                x(refreshIframe, n.id, o, i.data.htmlCode, l, a, i, n)
            }, i.data.timeWait * 1000);
        }
    }

    function p(a, o) {
        if (a.htmlCodeAddon && a.htmlCodeAddon.length > 0) {
            for (let i = 0; i < a.htmlCodeAddon.length; i++) {
                const e = document.createElement("div");
                let subJS = a.htmlCodeAddon[i];
                subJS = subJS.replaceAll("\\", "");
                e.innerHTML = subJS;
                e.childNodes.forEach(t => {
                    o.appendChild(g(t))
                })
            }
        }
    }

    function x(useIframe, id, o, htmlCode, height, a, i, n) {
        if (o) {
            o.innerHTML = "";
        }
        if (a && a.stickyAd && a.stickyAd.showStickyAd) {
            const c = document.createElement("style");
            const r = i.data.stickyAd.xPercent || 0;
            let e = `${i.data.stickyAd.yPercent || 0}%`;
            if (a.stickyAd.showClose) {
                const s = "5px";
                o.style.marginTop = "20px";
                const d = document.createElement("div");
                d.id = `close-${n.id}-close`;
                d.className = `close-${n.id}-close`;
                d.style.position = "absolute";
                if (i.data.stickyAd.yPercent == 0) {
                    d.style.bottom = `-${s}`;
                } else {
                    d.style.top = `-${s}`;
                }
                d.style.right = "-28px";
                d.style.cursor = "pointer";
                d.innerHTML = '<img style="width: 28px !important; height: 28px !important" src="https://platform.pubadx.one/adxone/close-icon.png"/>';
                d.onclick = () => {
                    o.remove()
                };
                o.appendChild(d);
                e = i.data.stickyAd.yPercent > 80 ? `calc(${e} - ${s})` : e
            }
            c.innerText = `#${n.id} { position: fixed !important; top: ${e}; left: ${r}%; transform: translate(-${r}%, -${i.data.stickyAd.yPercent || 0}%); z-index: 2147483647} `;
            if (useIframe) {
                c.innerText = `#${n.id}-1 { position: fixed !important; top: ${e}; left: ${r}%; transform: translate(-${r}%, -${i.data.stickyAd.yPercent || 0}%); z-index: 2147483647} ` + i.data.cssOutPartner;
            }
            o.appendChild(c)
        }
        if (useIframe) {
            b(id, o, htmlCode, height, i);
            p(a, o);

        } else {
            const e = document.createElement("div");
            e.innerHTML = htmlCode;
            e.childNodes.forEach(t => {
                o.appendChild(g(t))
            })
            p(a, o);
        }
    }

    let y;
    if (window.pubadxtag) {
        y = window.pubadxtag.divIds || []
    } else {
        y = []
    }

    if (Array.isArray(window.pubadxtag)) {
        for (let t = 0; t < window.pubadxtag.length; t++) {
            const n = window.pubadxtag[t];
            if (n.zoneid && n.id) {
                e(n)
            }
        }
    }

    return {push: e, divIds: y}
}();